
<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Futebol M√°ximo - Tracker Final com Filtro</title>
<style>
body { margin:0; font-family:Arial,sans-serif; background:#111; color:#fff; display:flex; }
.sidebar { width:250px; background:#000; padding:20px; display:flex; flex-direction:column; align-items:flex-start; }
.logo { font-size:20px; font-weight:bold; margin-bottom:30px; color:#4CAF50; }
.menu-item { margin:10px 0; cursor:pointer; padding:10px; border-radius:5px; }
.menu-item:hover { background:#222; }
.main-content { flex:1; padding:20px; overflow-y:auto; }
.header { display:flex; justify-content:space-between; align-items:center; }
.btn { background:#4CAF50; border:none; padding:10px 20px; border-radius:5px; color:#fff; cursor:pointer; font-size:16px; }
.btn:hover { background:#45a049; }
.list-container { margin-top:20px; display:grid; grid-template-columns:1fr; gap:10px; }
.list-item { background:#222; padding:15px; border-radius:8px; cursor:pointer; }
.video-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(240px,1fr)); gap:12px; margin-top:12px; }
.video-card { background:#181818; border-radius:8px; overflow:hidden; }
.video-card img { width:100%; display:block; }
.video-title { padding:8px; font-size:14px; }
.video-info { padding:0 8px 8px 8px; font-size:12px; color:#aaa; }
.modal { position:fixed; inset:0; display:none; place-items:center; background:rgba(0,0,0,.6); }
.modal.show { display:grid; }
.dialog { background:#222; padding:20px; border-radius:10px; width:100%; max-width:400px; }
.input { width:100%; padding:10px; border-radius:6px; border:none; margin-top:10px; }
</style>
</head>
<body>

<div class="sidebar">
  <div class="logo">‚öΩ Futebol M√°ximo</div>
  <div class="menu-item" onclick="showSavedChannels()">üì∫ Saved Channels</div>
</div>

<div class="main-content">
  <div class="header">
    <h1 id="pageTitle">Saved Channels</h1>
    <button class="btn" onclick="openModal('createList')">+ Criar Lista</button>
  </div>
  <div id="listsGrid" class="list-container"></div>
  <div id="listView" style="display:none">
    <button class="btn" onclick="backToLists()">‚Üê Voltar</button>
    <h2 id="listName"></h2>
    <button class="btn" onclick="openModal('addChannel')">+ Adicionar Canal</button>
    <div id="videosGrid" class="video-grid"></div>
  </div>
</div>

<div id="modalCreate" class="modal">
  <div class="dialog">
    <h3>Criar Lista</h3>
    <input id="inputListName" class="input" placeholder="Nome da lista">
    <div style="margin-top:10px;text-align:right">
      <button class="btn" onclick="closeModal('createList')">Cancelar</button>
      <button class="btn" onclick="saveList()">Salvar</button>
    </div>
  </div>
</div>

<div id="modalChannel" class="modal">
  <div class="dialog">
    <h3>Adicionar Canal</h3>
    <input id="inputChannelUrl" class="input" placeholder="https://www.youtube.com/@username">
    <div style="margin-top:10px;text-align:right">
      <button class="btn" onclick="closeModal('addChannel')">Cancelar</button>
      <button class="btn" onclick="addChannel()">Trackear</button>
    </div>
  </div>
</div>

<script>
const API_KEY = "AIzaSyD2737mJtrmC5efJz4gntSAxochOoq8LpE";
let state = JSON.parse(localStorage.getItem("tracker_state") || '{"lists":[]}');
let currentListId = null;

function saveState() { localStorage.setItem("tracker_state", JSON.stringify(state)); }

function renderLists() {
  document.getElementById("listView").style.display = "none";
  document.getElementById("listsGrid").innerHTML = "";
  state.lists.forEach(list => {
    const el = document.createElement("div");
    el.className = "list-item";
    el.textContent = list.name;
    el.onclick = () => openList(list.id);
    document.getElementById("listsGrid").appendChild(el);
  });
}

function openList(id) {
  currentListId = id;
  const list = state.lists.find(l=>l.id===id);
  document.getElementById("pageTitle").textContent = list.name;
  document.getElementById("listName").textContent = list.name;
  document.getElementById("listsGrid").style.display = "none";
  document.getElementById("listView").style.display = "block";
  renderVideos(list.videos || []);
}

function openModal(type) { document.getElementById(type==='createList'?'modalCreate':'modalChannel').classList.add("show"); }
function closeModal(type) { document.getElementById(type==='createList'?'modalCreate':'modalChannel').classList.remove("show"); }

function saveList() {
  const name = document.getElementById("inputListName").value.trim();
  if(!name) return;
  state.lists.push({ id: Date.now(), name, channels: [], videos: [] });
  saveState();
  renderLists();
  closeModal('createList');
  document.getElementById("inputListName").value = "";
}

function backToLists() {
  document.getElementById("listView").style.display = "none";
  document.getElementById("listsGrid").style.display = "grid";
  document.getElementById("pageTitle").textContent = "Saved Channels";
}

async function addChannel() {
  const url = document.getElementById("inputChannelUrl").value.trim();
  if(!url) return;
  closeModal('addChannel');
  const channelId = await resolveChannelId(url);
  if(!channelId) { alert("N√£o foi poss√≠vel resolver o canal."); return; }
  const list = state.lists.find(l=>l.id===currentListId);
  if(!list.channels.includes(channelId)) list.channels.push(channelId);
  await fetchAndSaveVideos(list, channelId);
  saveState();
}

async function resolveChannelId(url) {
  if(url.includes("/channel/")) return url.split("/channel/")[1];
  if(url.includes("@")) {
    const handle = url.split("@")[1];
    const res = await fetch(`https://www.googleapis.com/youtube/v3/channels?part=id&forHandle=@${handle}&key=${API_KEY}`);
    const data = await res.json();
    return data.items && data.items.length ? data.items[0].id : null;
  }
  return null;
}

function isoToSeconds(iso) {
  const match = iso.match(/PT(?:(\d+)H)?(?:(\d+)M)?(?:(\d+)S)?/);
  const h = parseInt(match[1]||0), m = parseInt(match[2]||0), s = parseInt(match[3]||0);
  return h*3600 + m*60 + s;
}

async function fetchAndSaveVideos(list, channelId) {
  const searchRes = await fetch(`https://www.googleapis.com/youtube/v3/search?key=${API_KEY}&channelId=${channelId}&part=snippet&order=date&maxResults=50&type=video`);
  const searchData = await searchRes.json();
  let videoIds = searchData.items.map(v=>v.id.videoId);
  if(videoIds.length===0) return;
  const detailRes = await fetch(`https://www.googleapis.com/youtube/v3/videos?key=${API_KEY}&id=${videoIds.join(',')}&part=snippet,contentDetails,statistics`);
  const detailData = await detailRes.json();
  let videos = detailData.items.map(v=>({
    id:v.id,
    title:v.snippet.title,
    thumb:v.snippet.thumbnails.medium.url,
    duration:v.contentDetails.duration,
    views:v.statistics.viewCount,
    publishedAt:v.snippet.publishedAt
  }));
  // Filtrar shorts <1min e lives >50min
  videos = videos.filter(v => {
    const secs = isoToSeconds(v.duration);
    return secs >= 60 && secs <= 3000; // 1min a 50min
  });
  // Ordenar por mais recente
  videos.sort((a,b)=>new Date(b.publishedAt)-new Date(a.publishedAt));
  list.videos = videos;
  renderVideos(videos);
}

function formatDuration(iso) {
  const match = iso.match(/PT(?:(\d+)H)?(?:(\d+)M)?(?:(\d+)S)?/);
  const h = parseInt(match[1]||0), m = parseInt(match[2]||0), s = parseInt(match[3]||0);
  return h>0?`${h}:${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`:`${m}:${s.toString().padStart(2,'0')}`;
}

function renderVideos(videos) {
  const grid = document.getElementById("videosGrid");
  grid.innerHTML = "";
  videos.forEach(v=>{
    const el = document.createElement("div");
    el.className="video-card";
    el.innerHTML = `
      <img src="${v.thumb}">
      <div class="video-title">${v.title}</div>
      <div class="video-info">
        Dura√ß√£o: ${formatDuration(v.duration)} | Views: ${v.views} | Publicado: ${new Date(v.publishedAt).toLocaleDateString()}
      </div>
    `;
    grid.appendChild(el);
  });
}

renderLists();
</script>
</body>
</html>
